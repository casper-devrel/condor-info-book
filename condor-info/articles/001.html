<!DOCTYPE HTML>
<html lang="en" class="dark" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Condor Deep Dive Part 1 - Casper 2.0 (Condor) Knowledge Base</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A guide to Casper v2.0 (Condor).">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././theme/catppuccin.css">
        <link rel="stylesheet" href="../.././theme/catppuccin-admonish.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('dark')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../condor-info/index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../../condor-info/faqs/current.html">Frequently Asked Questions</a></li><li class="chapter-item expanded "><a href="../../condor-info/articles/001.html" class="active"><strong aria-hidden="true">1.</strong> Condor Deep Dive Part 1</a></li><li class="chapter-item expanded "><a href="../../condor-info/articles/033-devnet.html"><strong aria-hidden="true">2.</strong> Applying for Devnet</a></li><li class="chapter-item expanded "><a href="../../condor-info/articles/004-local-setup.html"><strong aria-hidden="true">3.</strong> Running a local NCTL network with Condor</a></li><li class="chapter-item expanded "><a href="../../condor-info/articles/XXX-addressable_entity.html"><strong aria-hidden="true">4.</strong> Addressable Entity</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Casper 2.0 (Condor) Knowledge Base</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/casper-network/condor-info" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="casper-20-deep-dive-i"><a class="header" href="#casper-20-deep-dive-i">Casper 2.0 Deep Dive I</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Condor is the code name given to version 2.0 of the Casper platform, it represents a significant upgrade with a slew of new features accompanied by innumerable  optimisations &amp; improvements.  This is the first article in an extended series that aims to provide a high to medium level insight into the extensive work that has gone into the Condor release.  By the end of the series, the astute reader should have gained a fairly deep understanding of the Casper 2.0 platform.  Ideally they will be ready to take on the challenge of contributing to the platform as either an operator, a DApp developer and/or a core contributor.</p>
<p>In this article we examine the node software from the operator’s perspective.  I.E. what does an out of the box Casper 2.0 node setup look like in comparison to a Casper 1.X setup ?  Let’s begin by reviewing changes to the set of binaries, running processes, exposable ports, and API surface.</p>
<h2 id="binaries-processes-ports--apis"><a class="header" href="#binaries-processes-ports--apis">Binaries, Processes, Ports &amp; API’s</a></h2>
<p>In Condor the software has been factored out into three binaries, i.e. casper-node, casper-node-launcher and the new <strong>casper-sidecar</strong>.  Whilst the node process continues to be orchestrated by the node launcher, it’s functionality has been stripped back to the bare minimum required to participate in the network and to act as a verifiable source of truth.  All <strong>non-essential</strong> work has been off-loaded to the sidecar- this includes the JSON-RPC API.</p>
<p>Decoupling the processing of essential from non-essential work has advantages.  Firstly an operator is granted a finer degree of control over their operational setup in terms of performance &amp; security.  Secondly the JSON-RPC API can evolve independently of the core protocol, i.e. a change in the JSON-RPC will no longer trigger a protocol upgrade.  Lastly by stripping back the node’s functionality to the essentials it is easier to build alternative protocol clients (e.g. Go, Carbon, Zig, C++ …etc).</p>
<p>Such decoupling extends to the physical processes within which the binaries are executing.  This allows the node and sidecar binaries to be deployed to either a single machine or a pair of machines. It should be noted that sidecar binds to a port expsoed by the node, thus the dependency is one way.  From the node’s perspective the sidecar is simply another software agent binding to an exposed port.</p>
<p>With respect to services an operator now has the option to enable the node’s new <strong>binary API service</strong>.  This new service supports chain queries, node queries and transaction handling.  All data flowing in and out of this service is binary encoded.  This optimisation significantly reduces the cost of serialisation and deserialisation.    The sidecar is a consumer of this new service.</p>
<p>As before, with the exception of the node’s protocol network port, an operator can opt out of running any of the services running behind exposed ports.  The following lists the set of services running upon the node and sidecar.</p>
<ul>
<li>
<p><strong>Node</strong></p>
<ul>
<li>
<p><strong>Protocol</strong></p>
<ul>
<li>Protocol peer to peer network</li>
<li>Mandatory</li>
<li>Default Port = 34553</li>
</ul>
</li>
<li>
<p><strong>REST Server</strong></p>
<ul>
<li>Convenience API suitable for curl &amp; browsers</li>
<li>Optional</li>
<li>Default Port = 8888</li>
</ul>
</li>
<li>
<p><strong>Binary Server</strong></p>
<ul>
<li>Rich API for dispatching transactions into the network and for querying the node and/or chain state</li>
<li>Optional</li>
<li>Default Port = 7777</li>
</ul>
</li>
<li>
<p><strong>SSE (Server Side Events) Server</strong></p>
<ul>
<li>Realtime API of events emitted by the node when processing blocks and/or transactions</li>
<li>Optional</li>
<li>Default Port = 9999</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Sidecar</strong></p>
<ul>
<li>
<p><strong>JSON-RPC Server: Main</strong></p>
<ul>
<li>Rich API for dispatching transactions into the network and for querying chain/node state</li>
<li>Optional</li>
<li>Default Port = 7777</li>
</ul>
</li>
<li>
<p><strong>JSON-RPC Server: Speculative Execution</strong></p>
<ul>
<li>Specialized API for speculatively executing a transaction</li>
<li>Optional</li>
<li>Default Port = 7778</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="api-surface"><a class="header" href="#api-surface">API Surface</a></h3>
<p>Whilst changes to the API surface have been minimised, nevertheless there are several changes:</p>
<ul>
<li>
<p>API surface is now distributed over both the node and sidecar.</p>
</li>
<li>
<p>API endpoint request/response data types have changed in some cases.</p>
</li>
<li>
<p>Node binary API has been added.</p>
</li>
<li>
<p>Node SSE API has been rationalised and now exposes a single event channel.</p>
</li>
<li>
<p>JSON-RPC API has been moved to sidecar.</p>
</li>
<li>
<p>JSON-RPC API endpoints have been added and/or renamed.</p>
</li>
<li>
<p>Speculative Execution API has been moved to sidecar.</p>
</li>
</ul>
<p>The following summarises the new or renamed endpoints served by the various API servers at the time of writing.  We exclude the protocol endpoints as they are effectively internal to the system.</p>
<ul>
<li>
<p><strong>Node</strong></p>
<ul>
<li>
<p><strong>SSE (Server Side Events)</strong></p>
<ul>
<li>Main.FinalitySignature</li>
<li>Main.Shutdown</li>
<li>Main.TransactionAccepted (rename)</li>
<li>Main.TransactionExpired (rename)</li>
<li>Main.TransactionProcessed (rename)</li>
</ul>
</li>
<li>
<p><strong>Binary</strong></p>
<ul>
<li>Get
<ul>
<li>Record
<ul>
<li>ApprovalsHashes</li>
<li>BlockHeader</li>
<li>BlockBody</li>
<li>BlockMetadata</li>
<li>ExecutionResult</li>
<li>FinalizedTransactionApprovals</li>
<li>Transaction</li>
<li>Transfer</li>
</ul>
</li>
<li>Information
<ul>
<li>AvailableBlockRange</li>
<li>BlockHeader</li>
<li>BlockSynchronizerStatus</li>
<li>ChainspecRawBytes</li>
<li>ConsensusStatus</li>
<li>ConsensusValidatorChanges</li>
<li>LastProgress</li>
<li>LatestSwitchBlockHeader</li>
<li>NetworkName</li>
<li>NextUpgrade</li>
<li>NodeStatus</li>
<li>Peers</li>
<li>ReactorState</li>
<li>SignedBlock</li>
<li>Transaction</li>
<li>Uptime</li>
</ul>
</li>
<li>State
<ul>
<li>Balance</li>
<li>DictionaryItem</li>
<li>Item</li>
<li>ItemsByPrefix</li>
<li>AllItems</li>
<li>Trie</li>
</ul>
</li>
</ul>
</li>
<li>Try
<ul>
<li>AcceptTransaction</li>
<li>SpeculativeExec</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Sidecar</strong></p>
<ul>
<li>
<p><strong>JSON-RPC: Main</strong></p>
<ul>
<li>account_put_transaction</li>
<li>info_get_transaction</li>
<li>query_balance_details</li>
<li>state_get_entity</li>
</ul>
</li>
<li>
<p><strong>JSON-RPC: Speculative Execution</strong></p>
<ul>
<li>speculative_exec_txn</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Condor is the code name given to version 2.0 of the Casper platform, it represents a significant upgrade with a slew of new features accompanied by innumerable  optimisations &amp; improvements.  This was the first article in an extended series that aims to provide a high to medium level insight into the extensive work that has gone into the Condor release.  We examined the node software from the operator’s perspective by reviewing changes to the set of binaries, running processes, exposable ports, and API surface.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../condor-info/faqs/current.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../condor-info/articles/033-devnet.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../condor-info/faqs/current.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../condor-info/articles/033-devnet.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>