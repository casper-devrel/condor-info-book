<!DOCTYPE HTML>
<html lang="en" class="dark" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Addressable Entity - Casper 2.0 (Condor) Knowledge Base</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A guide to Casper v2.0 (Condor).">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././theme/catppuccin.css">
        <link rel="stylesheet" href="../.././theme/catppuccin-admonish.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "dark";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('dark')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../condor-info/index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../../condor-info/faqs/current.html">Frequently Asked Questions</a></li><li class="chapter-item expanded "><a href="../../condor-info/articles/001.html"><strong aria-hidden="true">1.</strong> Condor Deep Dive Part 1</a></li><li class="chapter-item expanded "><a href="../../condor-info/articles/033-devnet.html"><strong aria-hidden="true">2.</strong> Applying for Devnet</a></li><li class="chapter-item expanded "><a href="../../condor-info/articles/004-local-setup.html"><strong aria-hidden="true">3.</strong> Running a local NCTL network with Condor</a></li><li class="chapter-item expanded "><a href="../../condor-info/articles/XXX-addressable_entity.html" class="active"><strong aria-hidden="true">4.</strong> Addressable Entity</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Casper 2.0 (Condor) Knowledge Base</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/casper-network/condor-info" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="addressableentity-in-casper-20"><a class="header" href="#addressableentity-in-casper-20">AddressableEntity in Casper 2.0</a></h1>
<p>Casper 2.0 introduces significant changes in the representation and management of accounts and smart contracts, through the introduction of the <code>AddressableEntity</code> type. This new structure replaces the separate <code>AccountHash</code> and <code>ContractHash</code> used in Casper 1.x, bringing a unified approach to interact with entities on the network. Contracts can now hold and manage funds directly through associated purses, similar to user accounts. They can also manage their own keys, enabling more sophisticated access control.</p>
<p>In this article, we’ll dive into the details of <code>AddressableEntity</code>, exploring its structure and functionalities.</p>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h2>
<p><strong>AddressableEntity</strong></p>
<p>At its core, an <code>AddressableEntity</code> is a versatile data structure that represents both accounts and smart contracts within the Casper global state. It encapsulates all the necessary information for identifying and managing these entities. An <code>AddressableEntity</code> provides a unified interface for various operations, including authorization, access control, and execution of functions.</p>
<p><strong>EntityAddr</strong></p>
<p>An <code>EntityAddr</code> serves as the address for an <code>AddressableEntity</code>. It not only encodes the unique identifier (hash) of the entity but also its type. There are three distinct variants of <code>EntityAddr</code>:</p>
<ol>
<li><strong>System:</strong> Used for built-in, native contracts crucial for the blockchain’s operation.</li>
<li><strong>Account:</strong>  Represents a user’s account.</li>
<li><strong>SmartContract:</strong> Represents a user-deployed smart contract.</li>
</ol>
<p><strong>AddressableEntityHash</strong></p>
<p>The <code>AddressableEntityHash</code> is a newtype wrapper around a 32-byte hash (<code>HashAddr</code>). This hash functions as a unique identifier for the <code>AddressableEntity</code>, typically derived from either the account’s public key or the smart contract’s hash using hashing algorithm.</p>
<h2 id="the-inner-workings-of-addressableentity"><a class="header" href="#the-inner-workings-of-addressableentity">The inner workings of AddressableEntity</a></h2>
<p>Let’s dive into the critical components within an <code>AddressableEntity</code>:</p>
<ul>
<li><strong><code>protocol_version</code> (ProtocolVersion):</strong>  This field indicates the protocol version that the entity is compatible with. It ensures backward compatibility and allows for smooth upgrades as the Casper network evolves.</li>
<li><strong><code>entity_kind</code> (EntityKind):</strong> As mentioned earlier, this enum determines the type of entity – System, Account, or SmartContract.</li>
<li><strong><code>associated_keys</code> (AssociatedKeys):</strong> This data structure stores a map of public keys authorized to interact with the entity. Each key is associated with a weight that represents its voting power in decision-making processes within the entity.</li>
<li><strong><code>action_thresholds</code> (ActionThresholds):</strong> These thresholds define the minimum combined weight of associated keys required to authorize specific actions. The three main action types are <code>deployment</code>, <code>key_management</code>, and <code>upgrade_management</code>. Each action type has its own weight threshold, allowing for fine-grained control over permissions.</li>
<li><strong><code>entry_points</code> (EntryPoints):</strong> This component is relevant only for smart contracts. It defines the functions (entry points) that external actors can call on the contract, along with their parameters, return types, and access permissions.</li>
</ul>
<h2 id="obtaining-and-converting-keys"><a class="header" href="#obtaining-and-converting-keys">Obtaining and converting Keys</a></h2>
<p>In Casper 2.0, developers will primarily work with <code>Key::AddressableEntity</code> when referring to accounts and smart contracts. Here’s how you can create them and convert between different key formats:</p>
<h3 id="creating-addressableentity-keys"><a class="header" href="#creating-addressableentity-keys">Creating AddressableEntity Keys</a></h3>
<p><strong>From Account Hash:</strong></p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let addressable_entity_key = Key::AddressableEntity(EntityAddr::Account(account_hash)); 
<span class="boring">}</span></code></pre></pre>
<p><strong>From Smart Contract Hash:</strong></p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let addressable_entity_key = Key::AddressableEntity(EntityAddr::SmartContract(contract_hash));
<span class="boring">}</span></code></pre></pre>
<h3 id="extracting-accounthash-or-contracthash-from-a-key"><a class="header" href="#extracting-accounthash-or-contracthash-from-a-key">Extracting AccountHash or ContractHash from a Key</a></h3>
<p>You can extract the <code>AccountHash</code> or <code>ContractHash</code> from a <code>Key::AddressableEntity</code> using pattern matching:</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>//For Accounts
let account_hash = match addressable_entity_key {
    Key::AddressableEntity(EntityAddr::Account(hash)) =&gt; hash,
    _ =&gt; panic!("Not an account key"), 
};
//For Contracts
let contract_hash = match addressable_entity_key {
    Key::AddressableEntity(EntityAddr::SmartContract(hash)) =&gt; hash,
    _ =&gt; panic!("Not a contract key"), 
};
<span class="boring">}</span></code></pre></pre>
<h2 id="the-address-merge-in-condor"><a class="header" href="#the-address-merge-in-condor">The Address Merge in Condor</a></h2>
<p>The “Address Merge” in the Condor upgrade of Casper is a foundational shift, impacting how accounts and smart contracts are identified and interacted with.</p>
<p><strong>Global State Transformation:</strong></p>
<p>Post-Condor, all accounts and smart contract addresses residing within the global state will be automatically migrated to the <code>AddressableEntity</code> structure. This means the network itself will recognize and handle these entities using the new format.</p>
<p><strong>Smart Contract Compatibility Considerations:</strong></p>
<p>While the global state automatically transitions to <code>AddressableEntity</code>, existing contracts are expected to function without any modification.</p>
<ul>
<li>
<p><strong>Caller Identification:</strong>
Existing host functions used to identify the caller within your contract will continue to work as before, ensuring no disruption to your contract’s functionality. However, new host functions have been introduced that are specifically designed to work with the AddressableEntity format.</p>
</li>
<li>
<p><strong>External Contract Interaction:</strong> Other contracts may have updated their interfaces to accept AddressableEntity arguments. Its worth to verify the argument types to avoid potential errors.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong></p>
<ul>
<li>Upgrading a contract to a newer version may involve complexities, such as changes to the contract’s addressable hash. These changes might require coordination with centralized and decentralized exchanges, as well as communication with your community to ensure a smooth transition.</li>
</ul>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../condor-info/articles/004-local-setup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../condor-info/articles/004-local-setup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>